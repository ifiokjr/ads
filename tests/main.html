<!DOCTYPE html>
<html>
  <head>
    <title>Mocha Integration Tests</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../node_modules/mocha/mocha.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.16/require.min.js"></script>
  </head>
  <body>
    <div id='fixtures' style="display: none">
      <p id="orderId">09809</p>
      <p class="orderValue">£569.67</p>
      <p class="orderValue">£569.67</p>
      <p id="dynamicId">Not yet!</p>
      <table>
        <tr>
          <td class="productId">I AM AN ID</td>
          <td class="productValue">$45,07</td>
        </tr>
        <tr>
          <td class="productId">WOAH NELLY</td>
          <td class="productValue">$95,00</td>
        </tr>
      </table>

      <input type="hidden" value="PRODUCT001" id="pp">
    </div>
    <div id="mocha"></div>
<!--     <script src="../node_modules/mocha/mocha.js"></script> -->
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="../build/custom-debug.js"></script>
<!--
    <script src="../node_modules/sinon/pkg/sinon.js"></script>
    <script src="../node_modules/chai/chai.js"></script>
    <script src="../node_modules/chai-jquery/chai-jquery.js"></script>
    <script src="../node_modules/chai-things/lib/chai-things.js"></script>
    <script src="../node_modules/sinon/pkg/sinon.js"></script>
    <script src="../node_modules/sinon-chai/lib/sinon-chai.js"></script> -->
<!--     <script>
      var should = chai.should();
    </script> -->
    <script>
     window.veTagData = {};
     veTagData.settings = {}

     veTagData.settings.veAds = {

      config: {
        timeStamp: 'Wed May 06 2015 16:36:48 GMT+1000 (AUS Eastern Standard Time)',
        version: '2.0.0',
        uuid: 'abcd5678',
        storageAcrossProtocols: true,

        avoidDOM: false
      },
      pages: [
        {
          id: 1,
          name: 'Basket Page',
          type: 'basket', // Page where the products in the basket are captured and placed within
          urls: [
            {
              url: 'ranger-quiet.codio.io/tests/*',
              params: {page: 'basket'}
            },
            'awesome.com/*/cart.html'
          ],
          dynamicIdentifiers: [ ]
        },
        {
          id: 2,
          name: 'Complete Page',
          type: 'conversion',
          urls: [
            {
              url: 'ranger-quiet.codio.io/tests/*',
              params: {
                orderId: ':orderId',
                page: 'complete'
              }
            },
          ], 
          dynamicIdentifiers: [
            {
              selector: '#dynamicId',
              criteria: 'contains',
              values: ['Complete Page', 'Página Completa']
            }
          ]
        },
          
          {
          id: 2,
          name: 'Product Page',
          type: 'product',
          urls: [
            {
              url: 'ranger-quiet.codio.io/tests/*',
              params: {
                page: 'product'
              }
            },
          ],
          dynamicIdentifiers: [ ]
        },

        {
          id: 3,
          name: 'Custom Page',
          type: 'custom',
          urls: [],
          dynamicIdentifiers: []
        },

        {
          id: 4,
          name: 'Product Page',
          type: 'product',
          urls: [],
          dynamicIdentifiers: []
        }
      ],
      pixels: [
        {
          id: 1,

          name: 'Main Products Integration',

          type: 've',

          config: {
            journeyCode: 'adsfasdf' // Identifies the website in our backend
          },
          overrides: {
            active: false,
            ros: true,
            pages: [],
            data: []
          }
        },

        {
          id: 2,
          name: 'Flex Pixel',
          type: 'flex',
          config: {
            flexId: '123456' // Used to call in the flex tracking script
          },
          overrides: {}
        },

        {
          id: 3,
          name: 'DBM Pixel',
          type: 'dbm',
          config: {
            catROS: 'asdf',
            catConversion: 'kjkjh',
            src: 'fdas'
          },
          overrides: {}
        },


        {
          id: 4,
          name:'App Nexus Pixel',
          type: 'appNexus',
          config: {
            segmentROS: '111111', // ROS pixel segments
            segmentProduct: '222222', // Product pixel segemnts
            segmentConversion: '333333', // Conversion pixel segments
            conversionId: '654321' // Conversion pixel Id
          },
          overrides: {}
        },

        {
          id: 5,
          name: 'Custom ROS image pixel',
          type: 'customROS',
          config: {
            type: 'img', // options: ['script'|'img']
            src: 'https://trackingpixels.com/haha?i=can&see=you' // full url with protocol
          },
          overrides: {}
        },

        {
          id: 6,
          name: 'Custom conversion pixel',
          type: 'customConversion',
          config: {
            type: 'script', // options: ['script'|'img']
            src: 'https://trackingpixels.com/i/?know=what&you=bought'
          },
          overrides: {}
        }
      ],
      dataElements: [
        {
          id: 1,
          name: 'Order Value',
          type: 'orderVal', // ['orderId', 'orderVal', 'productId', 'productList', 'priceList', 'currency', 'other']
          pages: [ 2 ],
          fallback: '10', // any value set to __timestamp__ for a timestamp to be used.

          regex: {
            include: [  ], // Matches are run first
            exclude: [  ] // Exclude whatever is matched here
          },
          mask: 'currency', // [number, alphanumeric, currency, symbol, nothing]
          mapping: {
//             'GBP': '',
//             'AUD': '$'
          },
          capture: {
            type: 'selector',
            useMappings: false,
            mappingCriteria: 'contains', // [contains, equal]
            element: '.orderValue', // depends on capture.type ( either jQuery selector or globalVariable)
            keepChecking: false // will return as soon as it resolves, only for selector
          }

        }
        ,
        {
          id: 2,
          name: 'Order ID',
          type: 'orderId', // ['orderId', 'orderVal', 'productId', 'productList', 'priceList', 'currency', 'other']
          pages: [ 2 ],
          fallback: '__timestamp__', // any value set to __timestamp__ for a timestamp to be used.

          regex: {
            include: [], // Matches are run first
            exclude: [] // Exclude whatever is matched here
          },
          mask: 'nothing', // [number, alphanumeric, currency, symbol, nothing]
          mapping: {

          },
          capture: {
            type: 'selector',
            useMappings: false,
            mappingCriteria: 'contains', // [contains, equal]
            element: '#orderId', // depends on capture.type ( either jQuery selector or globalVariable)
            keepChecking: false // will return as soon as it resolves, only for selector
          }

        },
        {
          id: 3,
          name: 'Product List',
          type: 'productList', // ['orderId', 'orderVal', 'productId', 'productList', 'priceList', 'currency', 'other']
          pages: [ 1 ],
          fallback: '', // any value set to __timestamp__ for a timestamp to be used.

          regex: {
            include: [], // Matches are run first
            exclude: [] // Exclude whatever is matched here
          },
          mask: 'nothing', // [number, alphanumeric, currency, symbol, nothing]
          mapping: {

          },
          capture: {
            type: 'selector',
            useMappings: false,
            mappingCriteria: 'contains', // [contains, equal]
            element: '.productId', // depends on capture.type ( either jQuery selector or globalVariable)
            keepChecking: false // will return as soon as it resolves, only for selector
          }

        }, 
        {
          id: 4,
          name: 'Price List',
          type: 'priceList', // ['orderId', 'orderVal', 'productId', 'productList', 'priceList', 'currency', 'other']
          pages: [ 1 ],
          fallback: '', // any value set to __timestamp__ for a timestamp to be used.

          regex: {
            include: [], // Matches are run first
            exclude: [] // Exclude whatever is matched here
          },
          mask: 'currency', // [number, alphanumeric, currency, symbol, nothing]
          mapping: {

          },
          capture: {
            type: 'selector',
            useMappings: false,
            mappingCriteria: 'contains', // [contains, equal]
            element: '.productValue', // depends on capture.type ( either jQuery selector or globalVariable)
            keepChecking: false // will return as soon as it resolves, only for selector
          }

        }
      , {
          id: 5,
          name: 'Currency Symbol',
          type: 'currency', // ['orderId', 'orderVal', 'productId', 'productList', 'priceList', 'currency', 'other']
          pages: [ 1, 2, 3, 4 ],
          fallback: '', // any value set to __timestamp__ for a timestamp to be used.

          regex: {
            include: [  ], // Matches are run first
            exclude: [  ] // Exclude whatever is matched here
          },
          mask: 'symbol', // [number, alphanumeric, currency, symbol, nothing]
          mapping: {
            
          },
          capture: {
            type: 'selector',
            element: '.orderValue' // depends on capture.type ( either jQuery selector or globalVariable)
          }

        }
//      ,   {
//           id: 1,
//           name: 'Currency Symbol',
//           type: 'currency', // ['orderId', 'orderVal', 'productId', 'productList', 'priceList', 'currency', 'other']
//           pages: [ 1 ],
//           fallback: '10', // any value set to __timestamp__ for a timestamp to be used.

//           regex: {
//             include: [ ';kj;k' ], // Matches are run first
//             exclude: [ '' ] // Exclude whatever is matched here
//           },
//           mask: 'currency', // [number, alphanumeric, currency, symbol, nothing]
//           mapping: {
//             'GBP': '',
//             'AUD': '$'
//           },
//           capture: {
//             type: 'selector',
//             useMappings: false,
//             mappingCriteria: 'contains', // [contains, equal]
//             element: '#awesome', // depends on capture.type ( either jQuery selector or globalVariable)
//             keepChecking: false // will return as soon as it resolves, only for selector
//           }

//         }

      ]
    };

     
//      veTagData.settings.gdm = {
//           exclude: false,
//           ros: true,
//           flexId: '5032',
//           dbm: {
//             src: 'iamsrc',
//             cat: {
//               ros: 'iam-ros-cat',
//               conversion: 'iam-conversion-cat'
//             },
//             ros: true
//           },
//           completionId: 10000,
//           journeyCode: 'asdfasdf',
//           segmentIds: [100, 200, 300],
//           orderId: {
//               selector: '#orderId',
//               mask: '',
//               'regex': /[^0-9]/g,
//               page: {
//                   params: { },
//                   urls: [  ]
//               }
//           },
//           productPages: {
//               selector: '#pp',
//               'default': '000000',
//               page: {
//                   params: { page: 'product' },
//                   urls: [ 'ranger-quiet.codio.io/tests/main.*' ]
//               },
//               'regex': null
//           },
//           basketPages: {
//               selectors: {
//                   productId: '.productId',
//                   productPrice: '.productValue'
//               },
//              'default': '1.00',
//               page: {
//                   params: { page: 'basket' },
//                   urls: [ 'ranger-quiet.codio.io/tests/main.*' ]
//               },
//               'regex': /[^0-9,\.]/g
//           },
//           orderValue: {
//               selector: '.orderValue',
//               'default': '1.00',
//                mask: '',
//               page: {
//                   params: {  },
//                   urls: [ 'ranger-quiet.codio.io/tests/main.*' ]
//               },
//               updates: !!~document.URL.indexOf('updates') ? true : false,
//               'regex': /[^0-9,\.]/g
//           },


//           completePage: {
//               page: {
//                   params: { page: 'complete'  },
//                   urls: [ 'ranger-quiet.codio.io/tests/*'  ]
//               },

//               dynamicIdentifier: {
//                   selector: '#dynamicId',
//                   criteria: 'contains',
//                   value: 'Complete Page'
//               }
//           }
//       }

     setTimeout(function() {
       $('#dynamicId').text('This is the Complete Page');
       $('.orderValue').text('$100.00');
     }, 5000);
    </script>
    <script src="../build/ve-ads-dev.js"></script>
<!--     <script>mocha.setup('bdd')</script> -->
<!--     <script src="integration/tests.js"></script> -->
<!--     <script>
      mocha.run();
    </script> -->
  </body>
</html>
